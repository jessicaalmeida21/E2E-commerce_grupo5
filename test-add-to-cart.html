<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste - Adicionar ao Carrinho</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .test-button {
            background: #28a745;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        .test-button:hover {
            background: #218838;
        }
        .test-button.danger {
            background: #dc3545;
        }
        .test-button.danger:hover {
            background: #c82333;
        }
        .log-area {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 15px;
            border-radius: 5px;
            max-height: 400px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
            white-space: pre-wrap;
        }
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
    </style>
</head>
<body>
    <h1>üß™ Teste - Adicionar Produtos ao Carrinho</h1>
    
    <div class="test-container">
        <h2>üîß Controles de Teste</h2>
        <button class="test-button" onclick="testLogin()">1. Fazer Login</button>
        <button class="test-button" onclick="checkCurrentUser()">2. Verificar Usu√°rio</button>
        <button class="test-button" onclick="testAddProduct()">3. Adicionar Produto</button>
        <button class="test-button" onclick="checkCart()">4. Verificar Carrinho</button>
        <button class="test-button" onclick="testMultipleProducts()">5. Testar M√∫ltiplos Produtos</button>
        <button class="test-button danger" onclick="clearCart()">üóëÔ∏è Limpar Carrinho</button>
        <button class="test-button danger" onclick="clearLog()">üßπ Limpar Log</button>
    </div>
    
    <div class="test-container">
        <h2>üìä Status Atual</h2>
        <div id="status-area"></div>
    </div>
    
    <div class="test-container">
        <h2>üìù Log de Testes</h2>
        <div id="log-area" class="log-area"></div>
    </div>

    <!-- Scripts necess√°rios -->
    <script src="js/database.js"></script>
    <script src="js/api-service.js"></script>
    <script src="js/products.js"></script>
    <script src="js/login.js"></script>
    <script src="js/cart.js"></script>

    <script>
        let logArea = document.getElementById('log-area');
        let statusArea = document.getElementById('status-area');
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logMessage = `[${timestamp}] ${message}\n`;
            logArea.textContent += logMessage;
            logArea.scrollTop = logArea.scrollHeight;
            
            console.log(message);
        }
        
        function updateStatus(message, type = 'info') {
            statusArea.innerHTML = `<div class="status ${type}">${message}</div>`;
        }
        
        function clearLog() {
            logArea.textContent = '';
            statusArea.innerHTML = '';
        }
        
        // 1. Testar Login
        async function testLogin() {
            log('=== TESTANDO LOGIN ===');
            try {
                // Criar usu√°rio de teste se n√£o existir
                const testUser = {
                    id: 'test-001',
                    name: 'Cliente Teste',
                    email: 'teste@gmail.com',
                    password: 'teste123',
                    profile: 'customer',
                    createdAt: new Date().toISOString(),
                    isFixed: true
                };
                
                localStorage.setItem('currentUser', JSON.stringify(testUser));
                log('‚úÖ Usu√°rio de teste criado e logado');
                updateStatus('Usu√°rio logado: Cliente Teste', 'success');
            } catch (error) {
                log('‚ùå Erro no login: ' + error.message);
                updateStatus('Erro no login: ' + error.message, 'error');
            }
        }
        
        // 2. Verificar Usu√°rio Atual
        function checkCurrentUser() {
            log('=== VERIFICANDO USU√ÅRIO ATUAL ===');
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            if (currentUser) {
                log(`‚úÖ Usu√°rio logado: ${currentUser.name} (ID: ${currentUser.id})`);
                log(`üìß Email: ${currentUser.email}`);
                log(`üë§ Perfil: ${currentUser.profile}`);
                updateStatus(`Usu√°rio: ${currentUser.name}`, 'success');
            } else {
                log('‚ùå Nenhum usu√°rio logado');
                updateStatus('Nenhum usu√°rio logado', 'error');
            }
        }
        
        // 3. Testar Adicionar Produto
        async function testAddProduct() {
            log('=== TESTANDO ADICIONAR PRODUTO ===');
            try {
                // Tentar adicionar um produto espec√≠fico
                const productId = 'PROD-001';
                log(`Tentando adicionar produto: ${productId}`);
                
                const result = await productsModule.addToCart(productId);
                log(`‚úÖ Resultado: ${result}`);
                
                // Verificar carrinho imediatamente
                const cart = getUserCart();
                log(`üì¶ Itens no carrinho: ${cart.length}`);
                cart.forEach((item, index) => {
                    log(`  ${index + 1}. ${item.title} - Qtd: ${item.quantity} - Pre√ßo: ${item.price}`);
                });
                
                updateStatus(`Produto adicionado! Carrinho: ${cart.length} itens`, 'success');
            } catch (error) {
                log('‚ùå Erro ao adicionar produto: ' + error.message);
                updateStatus('Erro: ' + error.message, 'error');
            }
        }
        
        // 4. Verificar Carrinho
        function checkCart() {
            log('=== VERIFICANDO CARRINHO ===');
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            const userId = currentUser ? currentUser.id : 'guest';
            const cartKey = `cart_${userId}`;
            
            log(`üîë Chave do carrinho: ${cartKey}`);
            
            const cart = JSON.parse(localStorage.getItem(cartKey)) || [];
            log(`üì¶ Total de itens: ${cart.length}`);
            
            if (cart.length > 0) {
                cart.forEach((item, index) => {
                    log(`  ${index + 1}. ${item.title || 'Sem t√≠tulo'}`);
                    log(`     ID: ${item.id}`);
                    log(`     Pre√ßo: ${item.price || 'Sem pre√ßo'}`);
                    log(`     Quantidade: ${item.quantity || 0}`);
                    log(`     Imagem: ${item.image || 'Sem imagem'}`);
                    log('     ---');
                });
                
                const totalItems = cart.reduce((total, item) => total + (item.quantity || 0), 0);
                log(`üõí Total de itens: ${totalItems}`);
                
                updateStatus(`Carrinho: ${cart.length} produtos, ${totalItems} itens`, 'success');
            } else {
                log('üõí Carrinho vazio');
                updateStatus('Carrinho vazio', 'info');
            }
        }
        
        // 5. Testar M√∫ltiplos Produtos
        async function testMultipleProducts() {
            log('=== TESTANDO M√öLTIPLOS PRODUTOS ===');
            const testProducts = ['PROD-001', 'PROD-002', 'PROD-003'];
            
            for (const productId of testProducts) {
                try {
                    log(`Adicionando ${productId}...`);
                    await productsModule.addToCart(productId);
                    log(`‚úÖ ${productId} adicionado com sucesso`);
                } catch (error) {
                    log(`‚ùå Erro ao adicionar ${productId}: ${error.message}`);
                }
            }
            
            // Verificar resultado final
            const cart = getUserCart();
            log(`üì¶ Total final: ${cart.length} produtos`);
            updateStatus(`Teste completo: ${cart.length} produtos no carrinho`, 'success');
        }
        
        // Limpar Carrinho
        function clearCart() {
            log('=== LIMPANDO CARRINHO ===');
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            const userId = currentUser ? currentUser.id : 'guest';
            const cartKey = `cart_${userId}`;
            
            localStorage.removeItem(cartKey);
            log('üóëÔ∏è Carrinho limpo');
            updateStatus('Carrinho limpo', 'info');
        }
        
        // Fun√ß√£o auxiliar para obter carrinho (copiada do cart.js)
        function getUserCart() {
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            const userId = currentUser ? currentUser.id : 'guest';
            const cartKey = `cart_${userId}`;
            return JSON.parse(localStorage.getItem(cartKey)) || [];
        }
        
        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            log('üß™ Teste de Carrinho Iniciado');
            log('Clique nos bot√µes numerados em sequ√™ncia para testar');
        });
    </script>
</body>
</html>

