<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste GitHub Pages - Sistema de Estoque</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .container {
            background: rgba(255, 255, 255, 0.1);
            padding: 30px;
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }
        .status {
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            font-weight: bold;
        }
        .success { background: rgba(76, 175, 80, 0.3); }
        .warning { background: rgba(255, 193, 7, 0.3); }
        .error { background: rgba(244, 67, 54, 0.3); }
        .info { background: rgba(33, 150, 243, 0.3); }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            margin: 10px 5px;
            font-size: 16px;
        }
        button:hover {
            background: #45a049;
        }
        .test-results {
            margin-top: 20px;
            padding: 15px;
            background: rgba(0, 0, 0, 0.2);
            border-radius: 8px;
        }
        .timestamp {
            font-size: 12px;
            opacity: 0.8;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Teste do Sistema de Estoque - GitHub Pages</h1>
        
        <div class="status info">
            <strong>üìÖ √öltima atualiza√ß√£o:</strong> <span id="lastUpdate"></span>
        </div>
        
        <div class="status warning">
            <strong>‚ö†Ô∏è Aten√ß√£o:</strong> O GitHub Pages pode levar at√© 10 minutos para atualizar ap√≥s o push.
        </div>
        
        <h2>üîç Testes Autom√°ticos</h2>
        
        <button onclick="testDatabase()">Testar Database</button>
        <button onclick="testStock()">Testar Estoque</button>
        <button onclick="testCatalog()">Testar Cat√°logo</button>
        <button onclick="clearCache()">Limpar Cache</button>
        <button onclick="goToCatalog()">Ir para Cat√°logo</button>
        
        <div id="testResults" class="test-results">
            <p>Clique nos bot√µes acima para executar os testes...</p>
        </div>
        
        <div class="timestamp">
            P√°gina gerada em: <span id="pageTimestamp"></span>
        </div>
    </div>

    <script>
        // Mostrar timestamp da p√°gina
        document.getElementById('pageTimestamp').textContent = new Date().toLocaleString('pt-BR');
        document.getElementById('lastUpdate').textContent = new Date().toLocaleString('pt-BR');
        
        function log(message, type = 'info') {
            const results = document.getElementById('testResults');
            const timestamp = new Date().toLocaleTimeString('pt-BR');
            results.innerHTML += `<div class="status ${type}">[${timestamp}] ${message}</div>`;
            results.scrollTop = results.scrollHeight;
        }
        
        function clearResults() {
            document.getElementById('testResults').innerHTML = '';
        }
        
        async function testDatabase() {
            clearResults();
            log('üîÑ Testando carregamento do database...', 'info');
            
            try {
                // Tentar carregar o database com timestamp para evitar cache
                const timestamp = new Date().getTime();
                const response = await fetch(`./js/database.js?v=${timestamp}`);
                
                if (response.ok) {
                    log('‚úÖ Database carregado com sucesso!', 'success');
                    
                    // Tentar executar o script
                    const script = document.createElement('script');
                    script.src = `./js/database.js?v=${timestamp}`;
                    script.onload = () => {
                        if (typeof getAllProducts === 'function') {
                            const products = getAllProducts();
                            log(`üì¶ Total de produtos: ${products.length}`, 'success');
                            
                            // Verificar estoque
                            const withStock = products.filter(p => p.stock > 0);
                            const lowStock = products.filter(p => p.stock > 0 && p.stock <= 5);
                            const noStock = products.filter(p => p.stock === 0);
                            
                            log(`‚úÖ Com estoque: ${withStock.length}`, 'success');
                            log(`‚ö†Ô∏è Estoque baixo: ${lowStock.length}`, 'warning');
                            log(`‚ùå Sem estoque: ${noStock.length}`, 'error');
                        } else {
                            log('‚ùå Fun√ß√£o getAllProducts n√£o encontrada', 'error');
                        }
                    };
                    script.onerror = () => {
                        log('‚ùå Erro ao executar database.js', 'error');
                    };
                    document.head.appendChild(script);
                } else {
                    log(`‚ùå Erro ao carregar database: ${response.status}`, 'error');
                }
            } catch (error) {
                log(`‚ùå Erro: ${error.message}`, 'error');
            }
        }
        
        function testStock() {
            clearResults();
            log('üîÑ Testando sistema de estoque...', 'info');
            
            if (typeof getAllProducts === 'function') {
                const products = getAllProducts();
                
                // Testar produtos espec√≠ficos
                const testProducts = [
                    'iPhone 15 Pro Max',
                    'Galaxy S24 Ultra',
                    'iPhone 14 Pro',
                    'MacBook Pro',
                    'AirPods Pro'
                ];
                
                testProducts.forEach(productName => {
                    const product = products.find(p => 
                        p.title && p.title.toLowerCase().includes(productName.toLowerCase())
                    );
                    
                    if (product) {
                        const stockStatus = product.stock > 5 ? '‚úÖ' : product.stock > 0 ? '‚ö†Ô∏è' : '‚ùå';
                        log(`${stockStatus} ${product.title}: ${product.stock} unidades`, 
                            product.stock > 5 ? 'success' : product.stock > 0 ? 'warning' : 'error');
                    } else {
                        log(`‚ùå Produto n√£o encontrado: ${productName}`, 'error');
                    }
                });
            } else {
                log('‚ùå Database n√£o carregado. Execute "Testar Database" primeiro.', 'error');
            }
        }
        
        function testCatalog() {
            clearResults();
            log('üîÑ Testando p√°gina do cat√°logo...', 'info');
            
            // Verificar se a p√°gina do cat√°logo existe
            fetch('./pages/catalog.html')
                .then(response => {
                    if (response.ok) {
                        log('‚úÖ P√°gina do cat√°logo encontrada!', 'success');
                        log('üîó Voc√™ pode acessar em: ./pages/catalog.html', 'info');
                    } else {
                        log(`‚ùå Erro ao acessar cat√°logo: ${response.status}`, 'error');
                    }
                })
                .catch(error => {
                    log(`‚ùå Erro: ${error.message}`, 'error');
                });
        }
        
        function clearCache() {
            clearResults();
            log('üîÑ Limpando cache do navegador...', 'info');
            
            // Limpar localStorage
            if (typeof localStorage !== 'undefined') {
                localStorage.clear();
                log('‚úÖ LocalStorage limpo', 'success');
            }
            
            // Limpar sessionStorage
            if (typeof sessionStorage !== 'undefined') {
                sessionStorage.clear();
                log('‚úÖ SessionStorage limpo', 'success');
            }
            
            log('üîÑ Recomendado: Pressione Ctrl+Shift+R para recarregar sem cache', 'warning');
        }
        
        function goToCatalog() {
            window.open('./pages/catalog.html', '_blank');
        }
        
        // Executar teste autom√°tico ao carregar
        setTimeout(() => {
            log('üöÄ Executando teste autom√°tico...', 'info');
            testDatabase();
        }, 1000);
    </script>
</body>
</html>