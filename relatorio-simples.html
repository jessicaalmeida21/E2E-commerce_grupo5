<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Relat√≥rio de Estoque - Todos os Produtos</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .header { background: #f0f0f0; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
        .stats { display: flex; gap: 20px; margin: 20px 0; flex-wrap: wrap; }
        .stat-card { background: white; border: 2px solid #ddd; padding: 15px; border-radius: 8px; min-width: 150px; text-align: center; }
        .stat-card.green { border-color: #28a745; }
        .stat-card.red { border-color: #dc3545; }
        .stat-card.yellow { border-color: #ffc107; }
        .products { margin: 20px 0; }
        .product { border: 1px solid #ddd; margin: 10px 0; padding: 15px; border-radius: 5px; }
        .product.sem-estoque { border-left: 5px solid #dc3545; background: #fff5f5; }
        .product.estoque-baixo { border-left: 5px solid #ffc107; background: #fffbf0; }
        .product.com-estoque { border-left: 5px solid #28a745; background: #f0fff4; }
        .loading { text-align: center; font-size: 18px; margin: 40px 0; }
        .error { color: red; background: #ffe6e6; padding: 15px; border-radius: 5px; margin: 20px 0; }
        .success { color: green; background: #e6ffe6; padding: 15px; border-radius: 5px; margin: 20px 0; }
    </style>
</head>
<body>
    <div class="header">
        <h1>üì¶ Relat√≥rio de Estoque - Todos os Produtos</h1>
        <p>Verifica√ß√£o completa do estoque de todos os 500 produtos</p>
    </div>

    <div id="loading" class="loading">Carregando produtos...</div>
    <div id="error" class="error" style="display: none;"></div>
    <div id="stats" class="stats" style="display: none;"></div>
    <div id="results" style="display: none;"></div>

    <script src="js/database.js?v=41"></script>
    <script>
        console.log('Iniciando relat√≥rio de estoque...');

        function verificarEstoque() {
            try {
                // Verificar se a fun√ß√£o existe
                if (typeof getAllProducts !== 'function') {
                    throw new Error('Fun√ß√£o getAllProducts n√£o encontrada. Verifique se database.js foi carregado.');
                }

                console.log('Carregando produtos...');
                const produtos = getAllProducts();
                console.log(`Total de produtos carregados: ${produtos.length}`);

                if (!produtos || produtos.length === 0) {
                    throw new Error('Nenhum produto encontrado no banco de dados.');
                }

                // Analisar estoque
                let comEstoque = 0;
                let semEstoque = 0;
                let estoqueBaixo = 0;
                let totalUnidades = 0;

                const produtosSemEstoque = [];
                const produtosEstoqueBaixo = [];

                produtos.forEach((produto, index) => {
                    const estoque = produto.stock || 0;
                    totalUnidades += estoque;

                    if (estoque === 0) {
                        semEstoque++;
                        produtosSemEstoque.push(produto);
                    } else if (estoque <= 5) {
                        estoqueBaixo++;
                        produtosEstoqueBaixo.push(produto);
                    } else {
                        comEstoque++;
                    }
                });

                // Mostrar estat√≠sticas
                document.getElementById('stats').innerHTML = `
                    <div class="stat-card">
                        <h3>${produtos.length}</h3>
                        <p>Total de Produtos</p>
                    </div>
                    <div class="stat-card green">
                        <h3>${comEstoque}</h3>
                        <p>Com Estoque (>5)</p>
                    </div>
                    <div class="stat-card yellow">
                        <h3>${estoqueBaixo}</h3>
                        <p>Estoque Baixo (1-5)</p>
                    </div>
                    <div class="stat-card red">
                        <h3>${semEstoque}</h3>
                        <p>Sem Estoque (0)</p>
                    </div>
                    <div class="stat-card">
                        <h3>${totalUnidades}</h3>
                        <p>Total de Unidades</p>
                    </div>
                `;

                // Mostrar produtos problem√°ticos
                let resultadosHTML = '<div class="success">‚úÖ Relat√≥rio gerado com sucesso!</div>';

                if (produtosSemEstoque.length > 0) {
                    resultadosHTML += `
                        <h2>üî¥ Produtos SEM ESTOQUE (${produtosSemEstoque.length})</h2>
                        <div class="products">
                    `;
                    produtosSemEstoque.slice(0, 20).forEach(produto => {
                        resultadosHTML += `
                            <div class="product sem-estoque">
                                <strong>${produto.name}</strong><br>
                                Categoria: ${produto.category || 'N/A'}<br>
                                Pre√ßo: R$ ${produto.price}<br>
                                <strong style="color: red;">Estoque: ${produto.stock || 0}</strong>
                            </div>
                        `;
                    });
                    if (produtosSemEstoque.length > 20) {
                        resultadosHTML += `<p><em>... e mais ${produtosSemEstoque.length - 20} produtos sem estoque</em></p>`;
                    }
                    resultadosHTML += '</div>';
                }

                if (produtosEstoqueBaixo.length > 0) {
                    resultadosHTML += `
                        <h2>üü° Produtos com ESTOQUE BAIXO (${produtosEstoqueBaixo.length})</h2>
                        <div class="products">
                    `;
                    produtosEstoqueBaixo.slice(0, 20).forEach(produto => {
                        resultadosHTML += `
                            <div class="product estoque-baixo">
                                <strong>${produto.name}</strong><br>
                                Categoria: ${produto.category || 'N/A'}<br>
                                Pre√ßo: R$ ${produto.price}<br>
                                <strong style="color: orange;">Estoque: ${produto.stock || 0}</strong>
                            </div>
                        `;
                    });
                    if (produtosEstoqueBaixo.length > 20) {
                        resultadosHTML += `<p><em>... e mais ${produtosEstoqueBaixo.length - 20} produtos com estoque baixo</em></p>`;
                    }
                    resultadosHTML += '</div>';
                }

                // Mostrar alguns produtos com estoque normal
                const produtosComEstoque = produtos.filter(p => (p.stock || 0) > 5).slice(0, 10);
                if (produtosComEstoque.length > 0) {
                    resultadosHTML += `
                        <h2>üü¢ Exemplos de Produtos COM ESTOQUE (${comEstoque} total)</h2>
                        <div class="products">
                    `;
                    produtosComEstoque.forEach(produto => {
                        resultadosHTML += `
                            <div class="product com-estoque">
                                <strong>${produto.name}</strong><br>
                                Categoria: ${produto.category || 'N/A'}<br>
                                Pre√ßo: R$ ${produto.price}<br>
                                <strong style="color: green;">Estoque: ${produto.stock || 0}</strong>
                            </div>
                        `;
                    });
                    resultadosHTML += '</div>';
                }

                document.getElementById('results').innerHTML = resultadosHTML;

                // Esconder loading e mostrar resultados
                document.getElementById('loading').style.display = 'none';
                document.getElementById('stats').style.display = 'flex';
                document.getElementById('results').style.display = 'block';

                console.log('Relat√≥rio conclu√≠do!');
                console.log(`Resumo: ${produtos.length} produtos, ${comEstoque} com estoque, ${estoqueBaixo} estoque baixo, ${semEstoque} sem estoque`);

            } catch (error) {
                console.error('Erro ao gerar relat√≥rio:', error);
                document.getElementById('loading').style.display = 'none';
                document.getElementById('error').innerHTML = `
                    <strong>Erro:</strong> ${error.message}<br>
                    <em>Verifique o console do navegador para mais detalhes.</em>
                `;
                document.getElementById('error').style.display = 'block';
            }
        }

        // Aguardar carregamento completo
        window.addEventListener('load', () => {
            console.log('P√°gina carregada, iniciando verifica√ß√£o...');
            setTimeout(verificarEstoque, 500);
        });
    </script>
</body>
</html>