<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste - 500 Produtos</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .product { 
            border: 1px solid #ddd; 
            margin: 10px; 
            padding: 10px; 
            display: inline-block; 
            width: 200px; 
            vertical-align: top;
        }
        .product img { width: 100%; height: 150px; object-fit: cover; }
        .product h3 { font-size: 12px; margin: 5px 0; }
        .product p { font-size: 10px; color: #666; }
        .stats { background: #f0f0f0; padding: 10px; margin: 10px 0; }
        .error { color: red; }
        .success { color: green; }
        .loading { color: blue; }
    </style>
</head>
<body>
    <h1>Teste - 500 Produtos da API</h1>
    <div class="stats">
        <div>Status: <span id="status" class="loading">Carregando...</span></div>
        <div>Total de produtos: <span id="total">0</span></div>
        <div>Produtos com imagem: <span id="com-imagem">0</span></div>
        <div>Produtos sem imagem: <span id="sem-imagem">0</div>
        <div>Erros de carrinho: <span id="erros-carrinho">0</div>
    </div>
    <div id="products-container"></div>

    <script src="./js/api-service.js?v=10"></script>
    <script src="./js/products.js?v=10"></script>
    <script>
        let totalProducts = 0;
        let productsWithImage = 0;
        let productsWithoutImage = 0;
        let cartErrors = 0;

        async function testProducts() {
            try {
                console.log('Iniciando teste dos 500 produtos...');
                document.getElementById('status').textContent = 'Carregando produtos...';
                document.getElementById('status').className = 'loading';

                // Carregar produtos usando o módulo
                const products = await productsModule.loadProducts(1, 500);
                console.log('Produtos carregados:', products.length);
                
                totalProducts = products.length;
                document.getElementById('total').textContent = totalProducts;

                // Verificar imagens
                products.forEach(product => {
                    if (product.image && product.image !== '') {
                        productsWithImage++;
                    } else {
                        productsWithoutImage++;
                    }
                });

                document.getElementById('com-imagem').textContent = productsWithImage;
                document.getElementById('sem-imagem').textContent = productsWithoutImage;

                // Exibir produtos
                displayProducts(products);

                // Testar carrinho
                await testCart(products);

                document.getElementById('status').textContent = 'Teste concluído!';
                document.getElementById('status').className = 'success';

            } catch (error) {
                console.error('Erro no teste:', error);
                document.getElementById('status').textContent = 'Erro: ' + error.message;
                document.getElementById('status').className = 'error';
            }
        }

        function displayProducts(products) {
            const container = document.getElementById('products-container');
            container.innerHTML = '';

            products.forEach((product, index) => {
                const productDiv = document.createElement('div');
                productDiv.className = 'product';
                
                const hasImage = product.image && product.image !== '';
                const imageStatus = hasImage ? 'success' : 'error';
                
                productDiv.innerHTML = `
                    <img src="${product.image || 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjE1MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZGRkIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxNCIgZmlsbD0iIzk5OSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPk5vIEltYWdlPC90ZXh0Pjwvc3ZnPg=='}" 
                         alt="${product.title}" 
                         onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjE1MCIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiBmaWxsPSIjZGRkIi8+PHRleHQgeD0iNTAlIiB5PSI1MCUiIGZvbnQtZmFtaWx5PSJBcmlhbCIgZm9udC1zaXplPSIxNCIgZmlsbD0iIzk5OSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZHk9Ii4zZW0iPkVycm8gSW1hZ2VtPC90ZXh0Pjwvc3ZnPg=='">
                    <h3>${product.title}</h3>
                    <p><strong>ID:</strong> ${product.id}</p>
                    <p><strong>Categoria:</strong> ${product.category}</p>
                    <p><strong>Preço:</strong> R$ ${product.price.toFixed(2)}</p>
                    <p><strong>Imagem:</strong> <span class="${imageStatus}">${hasImage ? 'OK' : 'ERRO'}</span></p>
                    <button onclick="testAddToCart('${product.id}')">Testar Carrinho</button>
                `;
                
                container.appendChild(productDiv);
            });
        }

        async function testCart(products) {
            console.log('Testando carrinho...');
            const testProducts = products.slice(0, 10); // Testar apenas os primeiros 10
            
            for (const product of testProducts) {
                try {
                    await productsModule.addToCart(product.id);
                    console.log(`✓ Produto ${product.id} adicionado ao carrinho`);
                } catch (error) {
                    console.error(`✗ Erro ao adicionar produto ${product.id}:`, error);
                    cartErrors++;
                }
            }
            
            document.getElementById('erros-carrinho').textContent = cartErrors;
        }

        async function testAddToCart(productId) {
            try {
                await productsModule.addToCart(productId);
                alert('Produto adicionado ao carrinho com sucesso!');
            } catch (error) {
                alert('Erro ao adicionar produto: ' + error.message);
                cartErrors++;
                document.getElementById('erros-carrinho').textContent = cartErrors;
            }
        }

        // Iniciar teste quando a página carregar
        document.addEventListener('DOMContentLoaded', testProducts);
    </script>
</body>
</html>
